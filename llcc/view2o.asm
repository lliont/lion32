ORG 0
_XY EQU $4868
FMEMORG EQU $4864
MOVR.D (_cmdlbuf),A7
JRSR __main
POP A0
RET
_main:
PUSH A5
PUSH A6
PUSH A7
MOV.D A5,A7
MOV A7,SP
MOV.D A6,A7
SUB.D A6,12
SUB.D SP,44
MOV.D A1,A6
SUB.D A1,20
  MOV.D A2,A1
  MOVI A1,$00000000
MOV.D (A2),A1
MOV.D A1,A6
SUBI A1,8
PUSH A1
MOV.D A1,A6
SUB.D A1,20
  MOV.D A1,(A1)
POP A2
MOV.D (A2),A1
MOV.D A1,A6
SUB.D A1,16
PUSH A1
MOV.D A1,A6
SUB.D A1,20
  MOV.D A1,(A1)
POP A2
MOV.D (A2),A1
MOV.D A1,A5
PUSH (A1)
MOV.D A1,A6
SUB.D A1,20
  MOV.D A1,(A1)
POP A2
CMP.D A2,A1
JRLE _$2
GADR A1,_fn
MOV.D (A7),A1
MOV.D A1,A5
SUBI A1,4
  MOV.D A1,(A1)
  MOV.D A1,(A1)
MOV.D -4(A7),A1
  MOVI A1,$0000000b
MOV.D -8(A7),A1
GADR A1,_strncpy
MOVR.D (_argnum),3
MOVR.D (_argbs),A7
JSR A1
ADD.D SP,4
GADR A1,_$4
MOV.D (A7),A1
GADR A1,_fn
MOV.D -4(A7),A1
GADR A1,_printf
MOVR.D (_argnum),2
MOVR.D (_argbs),A7
JSR A1
ADD.D SP,4
GADR A1,_fn
MOV.D (A7),A1
GADR A1,_$5
MOV.D -4(A7),A1
MOV.D A1,A6
SUB.D A1,24
PUSH A1
GADR A1,_fopen
MOVR.D (_argnum),2
MOVR.D (_argbs),A7
JSR A1
POP A1
POP A2
MOV.D (A2),A1
MOV.D A1,A6
SUB.D A1,16
PUSH A1
MOV.D A1,A6
SUB.D A1,24
  MOV.D A1,(A1)
POP A2
MOV.D (A2),A1
_$2:
MOV.D A1,A6
SUB.D A1,16
  MOV.D A2,(A1)
  MOVI A1,$00000000
CMP.D A2,A1
JRG _$6
GADR A1,_$8
MOV.D (A7),A1
GADR A1,_fn
MOV.D -4(A7),A1
GADR A1,_printf
MOVR.D (_argnum),2
MOVR.D (_argbs),A7
JSR A1
ADD.D SP,4
GADR A1,_$7
JMP A1
_$6:
MOV.D A1,A6
SUBI A1,4
  MOV.D A2,A1
  MOVI A1,$00000001
MOV.D (A2),A1
_$9:
MOV.D A1,A6
SUB.D A1,16
  MOV.D A1,(A1)
MOV.D (A7),A1
GADR A1,_str
MOV.D -4(A7),A1
  MOV.D A1,$00000200
MOV.D -8(A7),A1
MOV.D A1,A6
SUB.D A1,24
PUSH A1
GADR A1,_read
MOVR.D (_argnum),3
MOVR.D (_argbs),A7
JSR A1
POP A1
POP A2
MOV.D (A2),A1
MOV.D A1,A6
SUBI A1,8
PUSH A1
MOV.D A1,A6
SUB.D A1,24
  MOV.D A1,(A1)
POP A2
MOV.D (A2),A1
MOV.D A1,A6
  MOV.D A2,A1
  MOVI A1,$00000000
MOV.D (A2),A1
GADR A1,_$15
JMP A1
_$12:
MOV.D A1,A6
PUSH (A1)
GADR A1,_str
POP A2
ADD.D A1,A2
CMOV.B A2,(A1)
  MOV.D A1,A2
SEX.B A1
MOV.D (A7),A1
GADR A1,_putchar
MOVR.D (_argnum),1
MOVR.D (_argbs),A7
JSR A1
ADD.D SP,4
MOV.D A1,A6
PUSH (A1)
GADR A1,_str
POP A2
ADD.D A1,A2
CMOV.B A2,(A1)
  MOV.D A1,A2
SEX.B A1
  MOV.D A2,A1
  MOVI A1,$0000000a
CMP.D A2,A1
JRNZ _$16
MOV.D A1,A6
SUBI A1,4
PUSH A1
MOV.D A1,A6
SUBI A1,4
  MOV.D A2,(A1)
  MOVI A1,$00000001
ADD.D A1,A2
POP A2
MOV.D (A2),A1
_$16:
MOV.D A1,A6
SUBI A1,4
  MOV.D A2,(A1)
  MOV.D A1,$00000016
MOVI A0,9
INT 4
  MOV.D A2,A0
  MOVI A1,$00000000
CMP.D A2,A1
JRNZ _$18
MOV.D A1,A6
SUB.D A1,28
PUSH A1
GADR A1,_getkey
MOVR.D (_argnum),0
MOVR.D (_argbs),A7
JSR A1
POP A1
POP A2
MOV.D (A2),A1
MOV.D A1,A6
SUBI A1,12
PUSH A1
MOV.D A1,A6
SUB.D A1,28
  MOV.D A1,(A1)
CMOV.B A2,A1
  MOV.D A1,A2
POP A2
MOV.B (A2),A1
MOV.D A1,A6
SUBI A1,4
PUSH A1
MOV.D A1,A6
SUBI A1,4
  MOV.D A2,(A1)
  MOVI A1,$00000001
ADD.D A1,A2
POP A2
MOV.D (A2),A1
_$18:
_$13:
MOV.D A1,A6
PUSH A1
MOV.D A1,A6
  MOV.D A2,(A1)
  MOVI A1,$00000001
ADD.D A1,A2
POP A2
MOV.D (A2),A1
_$15:
MOV.D A1,A6
PUSH (A1)
MOV.D A1,A6
SUBI A1,8
  MOV.D A1,(A1)
POP A2
CMP.D A2,A1
JRL _$12
_$10:
MOV.D A1,A6
SUBI A1,8
  MOV.D A2,(A1)
  MOV.D A1,$00000200
CMP.D A2,A1
JRNZ _$20
MOV.D A1,A6
SUBI A1,12
CMOV.B A2,(A1)
  MOV.D A1,A2
SEX.B A1
  MOV.D A2,A1
  MOV.D A1,$0000001b
CMP.D A2,A1
JRNZ _$9
_$20:
GADR A1,_$21
MOV.D (A7),A1
GADR A1,_printf
MOVR.D (_argnum),1
MOVR.D (_argbs),A7
JSR A1
ADD.D SP,4
MOV.D A1,A6
SUB.D A1,16
  MOV.D A1,(A1)
MOV.D (A7),A1
GADR A1,_fclose
MOVR.D (_argnum),1
MOVR.D (_argbs),A7
JSR A1
ADD.D SP,4
_$7:
_$1:
_main_end:
POP A4
MOV SP,A7
POP A7
POP A6
POP A5
POP A1
PUSH A4
JMP A1
_fn:
DSW 12
_str:
DS 513
_$21:
DB 10
DB 0
_$8:
DB 32
DB 69
DB 114
DB 114
DB 111
DB 114
DB 32
DB 79
DB 112
DB 101
DB 110
DB 105
DB 110
DB 103
DB 32
DB 70
DB 105
DB 108
DB 101
DB 58
DB 32
DB 37
DB 115
DB 10
DB 0
_$5:
DB 114
DB 0
_$4:
DB 10
DB 70
DB 105
DB 108
DB 101
DB 58
DB 32
DB 37
DB 115
DB 10
DB 0
__END: RET
